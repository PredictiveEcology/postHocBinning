---
title: "Isolde Chapter 1"
author: "Isolde Lane-Shaw"
date: "6/11/2020"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

```

```{r packages}

#list packages to load
library("SpaDES")
library("raster")
library("sf")
library("rgdal")
library("ggplot2")
library("googledrive")
library("data.table")
library("plotrix") 

```


# Get Landscape Data

Here the LLC2005 raster layer of Canada is read in using the LandR prepInputs function. It will be used as the rasterToMatch layer for other spatial layers to reproject to match, and will also provide land cover classification data.

```{r LCC2005}

rasterToMatch <- LandR::prepInputsLCC() 

```

```{r studyArea, echo=FALSE}

nameAreaShapefile <- "RIA_fiveTSA.shp" #specify file name
folderUrlArea <- "https://drive.google.com/open?id=15ufr8h19veqtxH3Rd3Qj84jWHgdEs0PB" #give file location 
archiveArea <- "RIA_fiveTSA.zip" #give archive name

studyArea <- prepInputs(targetFile = nameAreaShapefile, 
                            url = folderUrlArea,
                            archive = archiveArea, 
                            alsoExtract = "similar",
                            destinationPath = paste0(getwd(),"/studyArea"),
                            fun = "raster::shapefile",
                            rasterToMatch = rasterToMatch,
                            overwrite = TRUE)

```


```{r cropAndMask}

landscapeRaster <- raster::crop(rasterToMatch,studyArea) #create landscapeRaster by cropping rasterToMatch to studyArea
landscapeRaster <- mask(landscapeRaster, studyArea) #mask landscapeRaster to studyArea
Plot(landscapeRaster) #double check landscapeRaster 

```



# Get Bird Density Data

```{r getBirdDensityRaster}

nameBirdRaster <- "mosaic-OVEN-run3.tif" #specify file name
folderUrlBird <- "https://drive.google.com/file/d/1dOgCljSRI7sBKYtgOvxeFV5q_g5eBGMz/view?usp=sharing" #give file location 
archiveBird <- "birdDensityRasters.zip" #archive name

birdRaster <- prepInputs(targetFile = nameBirdRaster, 
                            url = folderUrlBird, 
                            archive = archiveBird, 
                            alsoExtract = "similar",
                            destinationPath = paste0(getwd(),"/birdRasterFiles"),
                            fun = "raster::raster",
                            rasterToMatch = landscapeRaster,
                            studyArea = studyArea,
                            overwrite = TRUE)

plot(birdRaster)

```


# Create dataframe of bird density by landscape

```{r getCellValues}

landBirdRasterStack <- stack(landscapeRaster, birdRaster)
cellValues <- as.data.frame(getValues(landBirdRasterStack))
cellValues <- na.omit(cellValues)
colnames(cellValues) <- c("landCoverClass", "birdDensity")
cellValues$landCoverClass <- as.factor(cellValues$landCoverClass)

```


```{r getCountsAndBirdMeans}

dtCellValues <- data.table(cellValues)
birdsByClass <- as.data.frame(dtCellValues[order(landCoverClass)
                              ][,list(classCount = .(.N),
                                      meanBirdDensity = mean(birdDensity),
                                      varBirdDensity = var(birdDensity),
                                      seBirdDensity = std.error(birdDensity)), 
                                      by = landCoverClass])

```